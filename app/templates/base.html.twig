{#
    templates/base.html.twig
    ========================

    Ce fichier est le squelette de base pour toutes les pages du site.
    Chaque autre template "√©tendra" ce fichier et remplira les blocs
    sp√©cifiques comme `title`, `body`, et `javascripts`.

    Principes Cl√©s :
    - DRY (Don't Repeat Yourself) : Tous les √©l√©ments communs (header, footer,
      CSS/JS globaux) sont d√©finis ici une seule fois.
    - SEO & Accessibilit√© : Contient les balises meta essentielles, les
      donn√©es structur√©es (Schema.org), et respecte les bonnes pratiques
      pour le r√©f√©rencement et l'accessibilit√©.
    - Bloc System : Utilise le syst√®me de blocs de Twig pour permettre
      aux templates enfants de surcharger des parties sp√©cifiques.
#}
<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        {# Le titre de la page. Peut √™tre surcharg√© par les templates enfants. #}
        <title>{% block title %}Destocard - Cartes Pok√©mon{% endblock %}</title>
        {# La m√©ta-description, cruciale pour le SEO. #}
        <meta name="description" content="{% block meta_description %}Votre boutique sp√©cialis√©e pour acheter et vendre des cartes Pok√©mon.{% endblock %}">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        {# 
            SECTION: Open Graph / Social Media Tags
            ---------------------------------------
            Ces balises `meta` contr√¥lent l'apparence de vos liens lorsqu'ils sont
            partag√©s sur les r√©seaux sociaux comme Facebook, Twitter, LinkedIn, etc.
            Elles sont essentielles pour une pr√©sentation professionnelle.
        #}
        {% block open_graph %}
            <meta property="og:title" content="{% block og_title %}{{ block('title') }}{% endblock %}">
            <meta property="og:description" content="{% block og_description %}{{ block('meta_description') }}{% endblock %}">
            <meta property="og:type" content="website">
            <meta property="og:url" content="{{ app.request.uri }}">
            <meta property="og:image" content="{{ absolute_url(asset('images/logo-destocard.png')) }}"> {# Remplacez par le chemin de votre image par d√©faut #}
            <meta property="og:image:alt" content="Logo Destocard - Boutique de cartes Pok√©mon">
            {# Twitter Card utilise des balises similaires √† Open Graph. #}
            <meta name="twitter:card" content="summary_large_image">
            <meta name="twitter:title" content="{% block twitter_title %}{{ block('og_title') }}{% endblock %}">
            <meta name="twitter:description" content="{% block twitter_description %}{{ block('og_description') }}{% endblock %}">
            <meta name="twitter:image" content="{{ absolute_url(asset('images/logo-destocard.png')) }}">
        {% endblock %}
        
        
        {#
            Favicon SVG pour une ic√¥ne de haute qualit√© et l√©g√®re.
            C'est une technique moderne pour g√©rer les favicons.
        #}
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>‚ö´Ô∏è</text><text y=%221.3em%22 x=%220.2em%22 font-size=%2276%22 fill=%22%23fff%22>sf</text></svg>">

        {# 
            SECTION: Feuilles de Style (CSS)
            --------------------------------
            La feuille de style principale `style.css` est charg√©e sur toutes les pages.
            Le bloc `stylesheets` permet aux templates enfants d'ajouter des
            styles sp√©cifiques √† leur page si n√©cessaire.
        #}
        <link rel="stylesheet" href="{{ asset('css/style.css')}}">
        {% block stylesheets %}{% endblock %}

        {#
            SECTION: Scripts JavaScript
            ---------------------------
            Tous les scripts sont charg√©s avec l'attribut `defer`.
            [[memory:1998723]] `defer` garantit que :
            1. Le script est t√©l√©charg√© en parall√®le du parsing HTML, sans le bloquer.
            2. Le script n'est ex√©cut√© qu'une fois que le DOM est enti√®rement construit.
            Ceci rend l'utilisation de `DOMContentLoaded` dans nos scripts redondante.
        #}
        <script src="/js/nav.js" defer></script>
        <script src="/js/csrf-protection.js" defer></script>
        <script src="/js/notifications.js" defer></script>
        <script src="/js/ajax.js" defer></script>
        <script src="/js/cart-counter.js" defer></script>
        <script src="/js/cart.js" defer></script>
        <script src="/js/favorites.js" defer></script>
        <script src="/js/theme-switcher.js" defer></script>
        <script src="{{ asset('js/address.js') }}" defer></script>
        <script src="{{ asset('js/checkout.js') }}" defer></script>
        <script src="{{ asset('js/product-form.js') }}" defer></script>
        {# Bloc pour les scripts sp√©cifiques √† une page. #}
        {% block javascripts %}{% endblock %}

    {# 
        SECTION: Donn√©es Structur√©es (Schema.org)
        -----------------------------------------
        Ce script JSON-LD est invisible pour l'utilisateur mais crucial pour le SEO.
        Il d√©crit la nature du site ("WebSite") et de l'organisation ("Organization")
        √† Google, ce qui peut am√©liorer l'affichage dans les r√©sultats de recherche (Rich Snippets).
    #}
        <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@graph": [
            {
              "@type": "WebSite",
              "@id": "{{ app.request.schemeAndHttpHost }}/#website",
              "url": "{{ app.request.schemeAndHttpHost }}/",
              "name": "Destocard",
              "description": "{{ block('meta_description') }}",
              "publisher": {
                "@id": "{{ app.request.schemeAndHttpHost }}/#organization"
              },
              "inLanguage": "fr-FR"
            },
            {
              "@type": "Organization",
              "@id": "{{ app.request.schemeAndHttpHost }}/#organization",
              "name": "Destocard",
              "url": "{{ app.request.schemeAndHttpHost }}/",
              "logo": {
                "@type": "ImageObject",
                "url": "{{ absolute_url(asset('images/logo-destocard.png')) }}",
                "width": "300", {# Remplacez par la largeur r√©elle de votre logo #}
                "height": "auto" {# Remplacez par la hauteur r√©elle de votre logo #}
              },
              "sameAs": [
                "https://twitter.com/votre_compte_twitter", {# Remplacez par vos vrais liens sociaux #}
                "https://facebook.com/votre_compte_facebook"
              ]
            }
          ]
        }
        </script>
    </head>
    {# 
        L'attribut `data-is-authenticated` est une astuce pour passer l'√©tat de connexion de l'utilisateur
        de Twig (c√¥t√© serveur) √† JavaScript (c√¥t√© client) de mani√®re simple et propre.
        C'est utilis√© par `auth-guard.js` pour les redirections.
    #}
    <body data-is-authenticated="{{ app.user ? 'true' : 'false' }}">
        {#
            Le Header est commun √† toutes les pages.
            Il contient le logo, la navigation principale et la navigation utilisateur.
            Il est `sticky` pour rester visible au d√©filement.
        #}
        <header class="site-header">
            <div class="container">
                <a href="{{ path('app_home') }}" class="site-header__logo">
                    <img src="{{ asset('media/images/logo2redim.png') }}" alt="Logo Destocard">
                </a>

                <nav class="site-header__nav-main" role="navigation" aria-label="Navigation principale">
                    <a href="{{ path('app_home') }}">Accueil</a>
                    {# La navigation s'adapte en fonction de l'√©tat de connexion de l'utilisateur (`app.user`) #}
                    {% if app.user %}
                        <a href="{{ path('app_product_index') }}">Produits</a>
                    {% endif %}
                </nav>

                <nav class="site-header__nav-user" role="navigation" aria-label="Navigation utilisateur">
                    {% if app.user %}
                        <a href="{{ path('app_user_products') }}">Mes Articles</a>
                        <a href="{{ path('app_favorites') }}">Favoris</a>
                        <a href="{{ path('app_message_index') }}">Messages</a>
                        <a href="{{ path('app_address_index') }}">Mes Adresses</a>
                        <a href="{{ path('cart') }}" class="nav-cart" title="Panier" aria-label="Panier">
                            üõí <span class="cart-count" aria-label="Nombre d'articles dans le panier">{{ cartCount ?? 0 }}</span>
                        </a>
                        <a href="{{ path('app_logout') }}" class="btn btn--secondary">D√©connexion</a>
                    {% else %}
                        <a href="{{ path('app_login') }}" class="btn btn--secondary">Connexion</a>
                        <a href="{{ path('app_register') }}" class="btn btn--primary">Inscription</a>
                    {% endif %}
                </nav>
            </div>
        </header>

        {#
            Le contenu principal de la page.
            C'est ici que les templates enfants injecteront leur contenu via le `block body`.
        #}
        <main>
            {# Affiche les "flash messages" (notifications de succ√®s, d'erreur, etc.) #}
            <div class="container">
                {% for label, messages in app.flashes %}
                    {% for message in messages %}
                        <div class="flash-message flash-message--{{ label }}" role="alert" aria-live="polite">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endfor %}
            </div>
            {% block body %}{% endblock %}
        </main>

       {# Le Footer est commun √† toutes les pages. #}
       <footer class="site-footer">
            <div class="container">
                <div class="site-footer__content">
                    <div class="footer-section">
                        <h3>Destocard</h3>
                        <p>Votre boutique sp√©cialis√©e en cartes Pok√©mon.</p>
                    </div>
                    <div class="footer-section">
                        <h3>Liens utiles</h3>
                        <ul>
                            <li><a href="#">√Ä propos</a></li>
                            <li><a href="#">Conditions g√©n√©rales</a></li>
                            <li><a href="#">FAQ</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h3>Contact</h3>
                        <ul>
                            <li><a href="mailto:contact@destocard.fr">contact@destocard.fr</a></li>
                        </ul>
                    </div>
                </div>
                <div class="site-footer__bottom">
                    &copy; {{ "now"|date("Y") }} Destocard. Tous droits r√©serv√©s.
                </div>
            </div>
        </footer>

        {# La navigation mobile, affich√©e en bas de l'√©cran sur les petits appareils. #}
        <nav class="mobile-nav" role="navigation" aria-label="Navigation mobile">
            <a href="{{ path('app_home') }}" class="mobile-nav__link" title="Accueil" aria-label="Accueil">üè†</a>
            <a href="{{ path('app_product_index') }}" class="mobile-nav__link" title="Produits" aria-label="Produits">üÉè</a>
            {% if app.user %}
                 <a href="{{ path('app_product_new') }}" class="mobile-nav__link" title="Vendre" aria-label="Vendre un article">‚ûï</a>
                <a href="{{ path('app_favorites') }}" class="mobile-nav__link" title="Favoris" aria-label="Mes favoris">‚ù§Ô∏è</a>
                <a href="{{ path('app_message_index') }}" class="mobile-nav__link" title="Messages" aria-label="Messages">‚úâÔ∏è</a>
                <a href="#" class="mobile-nav__link" title="Profil" aria-label="Mon profil">üë§</a>
            {% else %}
                <a href="{{ path('app_login') }}" class="mobile-nav__link" title="Connexion" aria-label="Se connecter">üë§</a>
            {% endif %}
        </nav>
    </body>
</html>
