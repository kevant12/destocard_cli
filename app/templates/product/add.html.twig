{% extends 'base.html.twig' %}

{% block title %}Ajouter un produit{% endblock %}

{% block body %}
<main class="add-main-bg">
    <section class="product-header">
        <div class="container">
            <h1 class="game-title">AJOUTER UN PRODUIT</h1>
        </div>
    </section>
    <section class="product-detail">
        <div class="container">
            {{ form_start(form, {'attr': {'class': 'product-add-form', 'novalidate': 'novalidate'}}) }}
                
                {{ form_errors(form) }}

                <div class="product-content add-product-flex">
                    <!-- Formulaire principal à gauche -->
                    <div class="product-info add-form-encadre">
                        <h2 class="product-add-title add-form-title">Détails du produit</h2>
                        <div class="detail-item">{{ form_row(form.extension) }}</div>
                        <div class="detail-item">{{ form_row(form.description) }}</div>
                        <div class="detail-item mt-4">
                            <button type="submit" class="btn-add">Ajouter le produit</button>
                        </div>
                    </div>

                    <!-- Bloc médias à droite -->
                    <div class="product-gallery add-media-preview">
                        <h3 class="add-form-title">Médias</h3>
                        
                        {# Le conteneur pour les champs de formulaire de média (cachés) #}
                        <div class="media-collection-wrapper" data-prototype="{{ form_widget(form.media.vars.prototype)|e('html_attr') }}">
                            {# Les formulaires de médias existants (pour l'édition) seront rendus ici #}
                            {{ form_widget(form.media) }}
                        </div>

                        {# Le conteneur pour les aperçus visibles #}
                        <div class="media-previews"></div>

                        {# Boutons d'action pour ajouter des médias #}
                        <div class="media-actions mt-3">
                            <button type="button" class="btn btn-secondary add-media-button">Ajouter une photo</button>
                        </div>

                        {# Section pour la capture webcam #}
                        <div class="webcam-capture-section mt-3">
                            <h4>Ou prendre une photo</h4>
                            <video class="webcam-video"></video>
                            <canvas class="webcam-canvas" style="display: none;"></canvas>
                            <div class="webcam-controls mt-2">
                                <button type="button" class="btn btn-info start-webcam-btn">Activer la webcam</button>
                                <button type="button" class="btn btn-success capture-photo-btn">Capturer</button>
                                <button type="button" class="btn btn-warning retake-photo-btn">Reprendre</button>
                                <button type="button" class="btn btn-primary add-captured-photo-btn">Ajouter la photo</button>
                            </div>
                        </div>
                    </div>
                </div>
            {{ form_end(form) }}
        </div>
    </section>
</main>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {# On charge le script dédié, avec defer pour qu'il s'exécute après le parsing du DOM #}
    <script src="{{ asset('js/product-form.js') }}" defer></script>
{% endblock %}