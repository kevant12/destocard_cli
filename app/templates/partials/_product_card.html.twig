{#
    templates/partials/_product_card.html.twig
    ==========================================

    Ce template partiel affiche une "carte" pour un produit unique.
    Il est con√ßu pour √™tre r√©utilis√© sur toutes les pages listant des produits
    (index, favoris, recherche, etc.) afin d'assurer un affichage coh√©rent et
    de respecter le principe DRY (Don't Repeat Yourself).

    Variables attendues :
    - product: (Obligatoire) L'entit√© `Products` √† afficher.
    - query:   (Optionnel) Le terme de recherche √† surligner dans le titre.
#}
<div class="card product-card">
    {# Lien vers la page d√©tail du produit sur l'image #}
    <a href="{{ path('app_product_show', {'id': product.id}) }}" class="card__image-container">
        {% if product.media|first %}
            <img src="{{ asset('uploads/products/' ~ product.media|first.fileName) }}" alt="{{ product.title }}">
        {% else %}
             <img src="{{ asset('images/placeholder.png') }}" alt="Image non disponible">
        {% endif %}
    </a>

    <div class="card__body">
        <h3 class="card__title">
            <a href="{{ path('app_product_show', {'id': product.id}) }}">
                {# 
                    Le filtre `highlight` est une extension Twig personnalis√©e (voir AppExtension.php).
                    Il est appliqu√© si `query` est d√©fini et non vide. `default('')` √©vite une erreur si query est null.
                #}
                {{ product.title|highlight(query|default('')) }}
            </a>
        </h3>
        <p class="card__subtitle">Vendu par {{ product.users.firstname }}</p>
    </div>

    <div class="card__footer">
        <span class="product-price">{{ product.price|number_format(2, ',', ' ') }} ‚Ç¨</span>
        <div class="product-actions">
            {# Le bouton "like" n'est affich√© que pour les utilisateurs connect√©s. #}
            {% if app.user %}
                <button class="btn-like {% if product in app.user.likes %}active{% endif %}"
                        data-product-id="{{ product.id }}"
                        data-csrf-token="{{ csrf_token('toggle_favorite'~product.id) }}"
                        aria-label="Ajouter {{ product.title }} aux favoris">
                    ‚ù§Ô∏è
                    {# üìä COMPTEUR DE LIKES - Affichage du nombre de personnes qui aiment ce produit #}
                    <span class="likes-count">{{ product.likes|length }}</span>
                </button>
            {% endif %}
            
            {# Le formulaire d'ajout au panier est toujours visible. La logique du panier fonctionne pour les invit√©s. #}
            <form method="post" action="{{ path('add_to_cart', {'id': product.id}) }}" class="add-to-cart-form inline-form">
                 <button type="submit" class="btn btn--secondary add-to-cart-btn">Ajouter au panier</button>
            </form>
        </div>
    </div>
</div> 